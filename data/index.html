<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A layout example with a side menu that hides on mobile, just like the Pure website.">
    <title>WLANThermo - Nano</title>
</head>
<body>

<div id="layout">
	<div class="headmenu">
    <!-- Menu toggle -->
    <a href="#menu" id="menuLink" class="menu-link">
        <!-- Hamburger icon -->
        <span></span>
    </a>
	<div class="loginname">N.C.</div>
	<div class="battery">N.C.</div>
	<div class="wifi">N.C.</div>
	</div>
	<div class="clear"></div>

    <div id="menu">
        <div class="pure-menu">
		<a class="pure-menu-heading" href="javascript:showIndex()"><img src="nano.png" alt="WLANThermo" height="58" width="130"> </a>
            <ul class="pure-menu-list">
                <li class="pure-menu-item"><a href="javascript:showIndex()" class="pure-menu-link">Home</a></li>
				<li class="pure-menu-item"><a href="javascript:showPlot()" class="pure-menu-link">Plot</a></li>
                <li class="pure-menu-item"><a href="javascript:showConfig()" class="pure-menu-link">Einstellungen</a></li>
				<li class="pure-menu-item"><a href="javascript:showWLAN()" class="pure-menu-link">WLAN</a></li>
                <li class="pure-menu-item"><a href="javascript:showAbout()" class="pure-menu-link">Über</a></li>
            </ul>
        </div>
    </div>

    <div id="main">
        <div class="header">
            <h1>WLANThermo - Nano</h1>
        </div>
		<!-- ################################################### -->
        <div id="index" class="content" class="hidden" style="display:none">
            <div class="pure-g">
                <div class="pure-u-1-1 pure-u-md-1-2 pure-u-lg-1-4">
					<div class="1-box channel">
						<div class="chtitle">N.C.</div>
						<div class="chnumber">N.C.</div>
							<div class="tempadjust">
								<div class="tempmin">N.C.</div>
								<div class="tempmax">N.C.</div>
							</div>
							<div class="temp">N.C.</div>
							<div class="clear"></div>
					</div>
                </div>
                <div class="pure-u-1-1 pure-u-md-1-2 pure-u-lg-1-4">
					<div class="1-box channel">
						<div class="chtitle">N.C.</div>
						<div class="chnumber">N.C.</div>
							<div class="tempadjust">
								<div class="tempmin">N.C.</div>
								<div class="tempmax">N.C.</div>
							</div>
							<div class="temp">N.C.</div>
							<div class="clear"></div>
					</div>
                </div>
                <div class="pure-u-1-1 pure-u-md-1-2 pure-u-lg-1-4">
					<div class="1-box channel">
						<div class="chtitle">N.C.</div>
						<div class="chnumber">N.C.</div>
							<div class="tempadjust">
								<div class="tempmin">N.C.</div>
								<div class="tempmax">N.C.</div>
							</div>
							<div class="temp">N.C.</div>
							<div class="clear"></div>
					</div>
                </div>
                <div class="pure-u-1-1 pure-u-md-1-2 pure-u-lg-1-4">
					<div class="1-box channel">
						<div class="chtitle">N.C.</div>
						<div class="chnumber">N.C.</div>
							<div class="tempadjust">
								<div class="tempmin">N.C.</div>
								<div class="tempmax">N.C.</div>
							</div>
							<div class="temp">N.C.</div>
							<div class="clear"></div>
					</div>
                </div>
                <div class="pure-u-1-1 pure-u-md-1-2 pure-u-lg-1-4">
					<div class="1-box channel">
						<div class="chtitle">N.C.</div>
						<div class="chnumber">N.C.</div>
							<div class="tempadjust">
								<div class="tempmin">N.C.</div>
								<div class="tempmax">N.C.</div>
							</div>
							<div class="temp">N.C.</div>
							<div class="clear"></div>
					</div>
                </div>
                <div class="pure-u-1-1 pure-u-md-1-2 pure-u-lg-1-4">
					<div class="1-box channel">
						<div class="chtitle">N.C.</div>
						<div class="chnumber">N.C.</div>
							<div class="tempadjust">
								<div class="tempmin">N.C.</div>
								<div class="tempmax">N.C.</div>
							</div>
							<div class="temp">N.C.</div>
							<div class="clear"></div>
					</div>
                </div>
                <div class="pure-u-1-1 pure-u-md-1-2 pure-u-lg-1-4">
					<div class="1-box channel">
						<div class="chtitle">N.C.</div>
						<div class="chnumber">N.C.</div>
							<div class="tempadjust">
								<div class="tempmin">N.C.</div>
								<div class="tempmax">N.C.</div>
							</div>
							<div class="temp">N.C.</div>
							<div class="clear"></div>
					</div>
                </div>
                <div class="pure-u-1-1 pure-u-md-1-2 pure-u-lg-1-4">
					<div class="1-box channel">
						<div class="chtitle">N.C.</div>
						<div class="chnumber">N.C.</div>
							<div class="tempadjust">
								<div class="tempmin">N.C.</div>
								<div class="tempmax">N.C.</div>
							</div>
							<div class="temp">N.C.</div>
							<div class="clear"></div>
					</div>
                </div>
            </div>
        </div>
		<!-- ################################################### -->
		<div id="wlan" class="content" style="display:none">
			<div class=".pure-g">
				<div class="pure-u-1-1">
						<table id="networkconnect" class="wlantable" width="100%">
							<!--Netzwerkliste -->
						</table> 

					
					<h3>Netzwerk wählen...</h3>
					<table id="networklist" class="wlantable" width="100%">
							<!--Netzwerkliste -->
					</table> 
					<div class="pure-button-group" role="group">
						<button class="pure-button">Suche</button>
						<button class="pure-button">Konfigurieren</button>
						<button class="pure-button">Mehr</button>
					</div>
				</div>
			</div>
        </div>
		<!-- ################################################### -->
		<div id="config" class="content" style="display:none">
            <div class="pure-g">
				<div class="pure-u-1-1 pure-u-lg-1-2"
					<h3>Kanal 1</h3>
						<form class="pure-form pure-form-stacked">
							<fieldset>

							<label for="CH1TMax">Temp.Max</label>
							<input id="CH1TMax" type="CH1TMax" placeholder="Temp.Max">

							<label for="CH1TMin">Temp.Min</label>
							<input id="CH1TMin" type="CH1TMin" placeholder="Temp.Min">
							
							<label for="color">Farbe</label>
							<select id="color">
								<option>rot</option>
								<option>blau</option>
								<option>gelb</option>
							</select>
							
							</fieldset>
						</form>
				</div>
				
				<div class="pure-u-1-1 pure-u-lg-1-2"
					<h3>Kanal 2</h3>
						<form class="pure-form pure-form-stacked">
							<fieldset>

							<label for="CH2TMax">Temp.Max</label>
							<input id="CH2TMax" type="CH2TMax" placeholder="Temp.Max">

							<label for="CH2TMin">Temp.Min</label>
							<input id="CH2TMin" type="CH2TMin" placeholder="Temp.Min">
							
							<label for="color">Farbe</label>
							<select id="color">
								<option>rot</option>
								<option>blau</option>
								<option>gelb</option>
							</select>
							
							</fieldset>
						</form>
				</div>
			</div>
			<div>
				<button class="button-success pure-button">Speichern</button>
				<button class="button-error pure-button">Abbrechen</button>
			</div>
        </div>
		<!-- ################################################### -->
		<div id="plot" class="content" style="display:none">
			<!-- html for config-Site -->
			<h1>WLANThermo - plot site</h1>
        </div>
		<!-- ################################################### -->
		<div id="about" class="content" style="display:none">
			<!-- html for about-Site -->
			<h1>WLANThermo - about site</h1>
        </div>
		<!-- ################################################### -->
    </div>
</div>

<script src="ui.js"></script>
<script>
	loadjscssfile('style.css','css');
	setInterval("readTemp();", 2000);
	document.getElementById("index").style.display = "inline";
	
	function showWLAN(){
		hideAll();
		document.getElementById("wlan").style.display = "inline";
		networkscan();
	}
	
	function showPlot(){
		hideAll();
		document.getElementById("plot").style.display = "inline";
	}	

	function showConfig(){
		hideAll();
		document.getElementById("config").style.display = "inline";
	}	
	
	function showIndex(){
		hideAll();
		document.getElementById("index").style.display = "inline";
	}	
	function showAbout(){
		hideAll();
		document.getElementById("about").style.display = "inline";
	}	
	function hideAll(){
		document.getElementById("index").style.display = "none";
		document.getElementById("wlan").style.display = "none";
		document.getElementById("config").style.display = "none";
		document.getElementById("plot").style.display = "none";
		document.getElementById("about").style.display = "none";
	}
	function loadJSON(url, callback) { 
		var xobj = new XMLHttpRequest();
		xobj.overrideMimeType("application/json");
		xobj.open('GET', url, true);
		xobj.onreadystatechange = function () {
			if (xobj.readyState == 4 && xobj.status == "200") {
				// .open will NOT return a value but simply returns undefined in async mode so use a callback
				callback(xobj.responseText);
			}
		}
		xobj.send(null);
	}
	
	function readTemp(){
		loadJSON('data', function (response) {
		//loadJSON(function(response) {	
			jsonresponse = JSON.parse(response);
			var x = document.getElementsByClassName("pure-u-1-1 pure-u-md-1-2 pure-u-lg-1-4");
			var i;
			for (i = 0; i < x.length; i++) {
				x[i].getElementsByClassName('1-box channel')[0].style.borderColor = jsonresponse.channel[i].color;
				x[i].getElementsByClassName('chtitle')[0].innerHTML = jsonresponse.channel[i].name;
				x[i].getElementsByClassName('chnumber')[0].innerHTML = "#" + jsonresponse.channel[i].number;
				x[i].getElementsByClassName('tempmin')[0].innerHTML = jsonresponse.channel[i].min + "°";
				x[i].getElementsByClassName('tempmax')[0].innerHTML = jsonresponse.channel[i].max + "°";
				x[i].getElementsByClassName('temp')[0].innerHTML = jsonresponse.channel[i].temp + "°" + jsonresponse.system.unit;					
			}
			document.getElementsByClassName("battery")[0].innerHTML = jsonresponse.system.soc + "%";
			document.getElementsByClassName("wifi")[0].innerHTML = jsonresponse.system.rssi + "dBm";
		})
	}
	
	function readSettings(){
		loadJSON('settings', function (response) {
			jsonresponse = JSON.parse(response);

		})
	}
	
   function loadjscssfile(filename, filetype) {
                if (filetype == "js") { //if filename is a external JavaScript file
                    var fileref = document.createElement('script')
                    fileref.setAttribute("type", "text/javascript")
                    fileref.setAttribute("src", filename)
                    alert('called');
                }
                else if (filetype == "css") { //if filename is an external CSS file
                    var fileref = document.createElement("link")
                    fileref.setAttribute("rel", "stylesheet")
                    fileref.setAttribute("type", "text/css")
                    fileref.setAttribute("href", filename)
                }
                if (typeof fileref != "undefined")
                    document.getElementsByTagName("head")[0].appendChild(fileref)
    }

		function networkscan(){
		loadJSON('networklist', function (response) {
			jsonresponse = JSON.parse(response);
			document.getElementById("networklist").innerHTML = '';
			document.getElementById("networkconnect").innerHTML = '';
			var table_networklist = document.getElementById("networklist");
			var table_networkconnect = document.getElementById("networkconnect");
			if (jsonresponse.Connect){
				var row = table_networkconnect.insertRow(0);
				var cell1 = row.insertCell(0);
				var cell2 = row.insertCell(1);
				var cell3 = row.insertCell(2);
				var cell4 = row.insertCell(3);
				cell1.innerHTML = '&#10003;';
				cell1.className = 'row-Check';
				cell2.innerHTML = jsonresponse.SSID;
				cell2.className = 'row-SSID';
				cell3.innerHTML = 'dBm';
				cell3.className = 'row-RSSI';
				cell4.innerHTML = 'Enc';
				cell4.className = 'row-Enc';				
			}
			NetworkconnectRowClick();
			for (var i = 0; i < jsonresponse.Scan.length; i++) {
				var row = table_networklist.insertRow(-1);
				var cell1 = row.insertCell(0);
				cell1.className = 'row-Check';
				var cell2 = row.insertCell(1);
				var cell3 = row.insertCell(2);
				var cell4 = row.insertCell(3);
				cell1.innerHTML = '';
				cell1.className = 'row-Check';
				cell2.innerHTML = jsonresponse.Scan[i].SSID;
				cell2.className = 'row-SSID';
				cell3.innerHTML = jsonresponse.Scan[i].RSSI + 'dBm';
				cell3.className = 'row-RSSI';
				cell4.innerHTML = jsonresponse.Scan[i].Enc;	
				cell4.className = 'row-Enc';				
			}
			NetworklistRowClick();
		})
	}
	
	function NetworklistRowClick() {
		var table = document.getElementById("networklist");
		var rows = table.rows; // or table.getElementsByTagName("tr");
		for (var i = 0; i < rows.length; i++) {
			rows[i].onclick = (function() { // closure
				var cnt = i; // save the counter to use in the function
				return function() {
				  alert("row"+cnt+" data="+this.cells[1].innerHTML);
				}    
			})(i);
		}
	}
	
	function NetworkconnectRowClick() {
		var table = document.getElementById("networkconnect");
		var rows = table.rows; // or table.getElementsByTagName("tr");
		for (var i = 0; i < rows.length; i++) {
			rows[i].onclick = (function() { // closure
				var cnt = i; // save the counter to use in the function
				return function() {
				  alert("row"+cnt+" data="+this.cells[1].innerHTML);
				}    
			})(i);
		}
	}
	readTemp();
</script> 

</body>
</html>
